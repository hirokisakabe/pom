# LLM Integration

pom supports use cases where slides are created from JSON generated by LLMs (GPT-4o, Claude, etc.).

## LLM Specification Guide

This section provides a compact specification for having LLMs generate JSON in pom format. Include it in your system prompt.

### Standard Settings

```
Slide size: { w: 1280, h: 720 }
Standard padding: 48px (entire slide), 18-24px (internal boxes)
Standard gap: 12-24px
```

### Node List

| type         | Purpose      | Main Properties                                                             |
| ------------ | ------------ | --------------------------------------------------------------------------- |
| text         | Text         | text, fontPx, color, bold, alignText, bullet                                |
| vstack       | Vertical     | children[], gap, alignItems, justifyContent                                 |
| hstack       | Horizontal   | children[], gap, alignItems, justifyContent                                 |
| box          | Wrapper      | children (single node)                                                      |
| table        | Table        | columns[], rows[], defaultRowHeight                                         |
| shape        | Shape        | shapeType, fill, line, text, fontPx                                         |
| chart        | Chart        | chartType(bar/line/pie/area/doughnut/radar), data[], showLegend, radarStyle |
| timeline     | Timeline     | direction(horizontal/vertical), items[]                                     |
| matrix       | Matrix       | axes, quadrants, items[]                                                    |
| tree         | Tree         | layout, nodeShape, data, connectorStyle                                     |
| flow         | Flowchart    | direction(TB/LR), nodes[], edges[]                                          |
| processArrow | ProcessArrow | direction(horizontal/vertical), steps[]                                     |
| image        | Image        | src                                                                         |

### Common Properties

Available for all nodes:

- `w`, `h`: Size (number in px / `"max"` / `"50%"`)
- `padding`: Margin (number or `{ top, right, bottom, left }`)
- `backgroundColor`: Background color (6-digit hex, e.g., `"F8FAFC"`)
- `border`: Border (`{ color, width, dashType }`)
- `borderRadius`: Corner radius in px (e.g., `8`, `16`)

### alignItems / justifyContent

- alignItems: `"start"` | `"center"` | `"end"` | `"stretch"`
- justifyContent: `"start"` | `"center"` | `"end"` | `"spaceBetween"`

### Font Size Guidelines

| Purpose   | fontPx |
| --------- | ------ |
| Title     | 28-40  |
| Heading   | 18-24  |
| Body      | 13-16  |
| Footnotes | 10-12  |

### Pattern Examples

#### 1. Basic Slide Structure

```json
{
  "type": "vstack",
  "w": "100%",
  "h": "max",
  "padding": 48,
  "gap": 24,
  "alignItems": "stretch",
  "children": [
    { "type": "text", "text": "Title", "fontPx": 32, "bold": true },
    { "type": "text", "text": "Body text", "fontPx": 14 }
  ]
}
```

#### 2. Two-Column Layout

```json
{
  "type": "hstack",
  "gap": 24,
  "alignItems": "start",
  "children": [
    {
      "type": "box",
      "w": "50%",
      "padding": 20,
      "backgroundColor": "FFFFFF",
      "children": { "type": "text", "text": "Left column", "fontPx": 14 }
    },
    {
      "type": "box",
      "w": "50%",
      "padding": 20,
      "backgroundColor": "FFFFFF",
      "children": { "type": "text", "text": "Right column", "fontPx": 14 }
    }
  ]
}
```

#### 3. Bullet Points

```json
{
  "type": "text",
  "text": "Item 1\nItem 2\nItem 3",
  "fontPx": 14,
  "bullet": true
}
```

Numbered list:

```json
{
  "type": "text",
  "text": "Step 1\nStep 2\nStep 3",
  "fontPx": 14,
  "bullet": { "type": "number" }
}
```

Bullet options:

- `bullet: true` - Standard bullet points (â€¢)
- `bullet: { type: "number" }` - Numbered (1. 2. 3.)
- `bullet: { type: "number", numberType: "alphaLcPeriod" }` - Alphabet (a. b. c.)
- `bullet: { type: "number", numberStartAt: 5 }` - Specify starting number

#### 4. Table

```json
{
  "type": "table",
  "defaultRowHeight": 36,
  "columns": [{ "width": 150 }, { "width": 200 }],
  "rows": [
    {
      "cells": [
        {
          "text": "Item",
          "fontPx": 14,
          "bold": true,
          "backgroundColor": "DBEAFE"
        },
        {
          "text": "Value",
          "fontPx": 14,
          "bold": true,
          "backgroundColor": "DBEAFE"
        }
      ]
    },
    {
      "cells": [
        { "text": "Sales", "fontPx": 13 },
        { "text": "$1M", "fontPx": 13 }
      ]
    }
  ]
}
```

Omitting column width (evenly distributed from table width):

```json
{
  "type": "table",
  "w": 400,
  "columns": [{}, {}, {}],
  "rows": [...]
}
```

#### 5. Shape (with text)

```json
{
  "type": "shape",
  "shapeType": "roundRect",
  "w": 200,
  "h": 60,
  "text": "Button style",
  "fontPx": 16,
  "fill": { "color": "1D4ED8" },
  "color": "FFFFFF"
}
```

Common shapeTypes: `rect`, `roundRect`, `ellipse`, `triangle`, `star5`, `cloud`, `downArrow`

#### 6. Chart

```json
{
  "type": "chart",
  "chartType": "bar",
  "w": 500,
  "h": 300,
  "data": [
    {
      "name": "Sales",
      "labels": ["Jan", "Feb", "Mar"],
      "values": [100, 150, 200]
    }
  ],
  "showLegend": true,
  "chartColors": ["0088CC"]
}
```

#### 7. Timeline (Roadmap)

```json
{
  "type": "timeline",
  "direction": "horizontal",
  "w": 1000,
  "h": 120,
  "items": [
    {
      "date": "Q1",
      "title": "Phase 1",
      "description": "Foundation",
      "color": "4CAF50"
    },
    {
      "date": "Q2",
      "title": "Phase 2",
      "description": "Development",
      "color": "2196F3"
    },
    {
      "date": "Q3",
      "title": "Phase 3",
      "description": "Release",
      "color": "FF9800"
    }
  ]
}
```

Vertical timeline:

```json
{
  "type": "timeline",
  "direction": "vertical",
  "w": 400,
  "h": 300,
  "items": [
    { "date": "Week 1", "title": "Planning" },
    { "date": "Week 2-3", "title": "Development" },
    { "date": "Week 4", "title": "Release" }
  ]
}
```

#### 8. Matrix (Positioning Map)

```json
{
  "type": "matrix",
  "w": 600,
  "h": 500,
  "axes": { "x": "Cost", "y": "Effect" },
  "quadrants": {
    "topLeft": "Quick Wins",
    "topRight": "Strategic",
    "bottomLeft": "Low Priority",
    "bottomRight": "Avoid"
  },
  "items": [
    { "label": "A", "x": 0.2, "y": 0.8, "color": "4CAF50" },
    { "label": "B", "x": 0.7, "y": 0.6 }
  ]
}
```

Note: x/y coordinates are 0-1 relative values. (0,0) = bottom-left, (1,1) = top-right.

#### 9. Tree (Organization Chart / Decision Tree)

```json
{
  "type": "tree",
  "layout": "vertical",
  "nodeShape": "roundRect",
  "w": 600,
  "h": 400,
  "data": {
    "label": "CEO",
    "color": "1D4ED8",
    "children": [
      {
        "label": "CTO",
        "color": "0EA5E9",
        "children": [{ "label": "Engineer A" }, { "label": "Engineer B" }]
      },
      {
        "label": "CFO",
        "color": "16A34A",
        "children": [{ "label": "Accountant" }]
      }
    ]
  },
  "connectorStyle": { "color": "333333", "width": 2 }
}
```

Horizontal tree (decision tree):

```json
{
  "type": "tree",
  "layout": "horizontal",
  "nodeShape": "rect",
  "w": 600,
  "h": 300,
  "data": {
    "label": "Start",
    "children": [
      {
        "label": "Option A",
        "children": [{ "label": "Result 1" }, { "label": "Result 2" }]
      },
      {
        "label": "Option B",
        "children": [{ "label": "Result 3" }]
      }
    ]
  }
}
```

Options:

- `layout`: "vertical" (top to bottom) or "horizontal" (left to right)
- `nodeShape`: "rect", "roundRect", or "ellipse"
- `nodeWidth`, `nodeHeight`: Node size in px (default: 120x40)
- `levelGap`: Gap between levels (default: 60)
- `siblingGap`: Gap between siblings (default: 20)

#### 10. Flow (Flowchart)

```json
{
  "type": "flow",
  "direction": "TB",
  "w": 400,
  "h": 300,
  "nodes": [
    { "id": "start", "label": "Start", "shape": "ellipse", "color": "4CAF50" },
    { "id": "process", "label": "Process", "shape": "rect" },
    { "id": "decision", "label": "OK?", "shape": "diamond", "color": "FF9800" },
    { "id": "end", "label": "End", "shape": "ellipse", "color": "E91E63" }
  ],
  "edges": [
    { "from": "start", "to": "process" },
    { "from": "process", "to": "decision" },
    { "from": "decision", "to": "end", "label": "Yes" }
  ]
}
```

Options:

- `direction`: "TB" (top to bottom) or "LR" (left to right)
- `nodes[].shape`: "rect", "roundRect", "diamond", "ellipse", "parallelogram"
- `nodeWidth`, `nodeHeight`: Node size in px (default: 120x40)
- `nodeGap`: Gap between nodes (default: 60)
- `rankGap`: Gap between ranks (default: 80)

#### 11. ProcessArrow (Chevron Process Diagram)

```json
{
  "type": "processArrow",
  "direction": "horizontal",
  "w": 1000,
  "h": 80,
  "steps": [
    { "label": "Planning", "color": "4472C4" },
    { "label": "Design", "color": "5B9BD5" },
    { "label": "Development", "color": "70AD47" },
    { "label": "Testing", "color": "FFC000" },
    { "label": "Release", "color": "ED7D31" }
  ]
}
```

Options:

- `direction`: "horizontal" or "vertical"
- `steps[].label`: Step label
- `steps[].color`: Step color (hex, default: "4472C4")
- `steps[].textColor`: Text color (hex, default: "FFFFFF")
- `itemWidth`, `itemHeight`: Step size in px (default: 150x60)
- `gap`: Gap between steps (default: -15, negative for overlap)
- `fontPx`: Font size (default: 14)
- `bold`: Bold text (default: false)

### Important Notes

| NG                       | OK                | Description                             |
| ------------------------ | ----------------- | --------------------------------------- |
| `"#FF0000"`              | `"FF0000"`        | No # needed for color                   |
| `"left"`                 | `"start"`         | alignItems/justifyContent use start/end |
| `children: [...]` in box | `children: {...}` | box's children is a single node         |
| `width: "100%"`          | `w: "100%"`       | Property names are w/h                  |

## Input Schema Validation

Use `inputPomNodeSchema` to validate JSON generated by LLMs.

```typescript
import { inputPomNodeSchema, buildPptx, InputPOMNode } from "@hirokisakabe/pom";

// Validate JSON output from LLM
const jsonFromLLM = `{
  "type": "vstack",
  "padding": 48,
  "gap": 24,
  "children": [
    { "type": "text", "text": "Title", "fontPx": 32, "bold": true },
    { "type": "text", "text": "Body text", "fontPx": 16 }
  ]
}`;

const parsed = JSON.parse(jsonFromLLM);
const result = inputPomNodeSchema.safeParse(parsed);

if (result.success) {
  // Validation successful - generate PPTX
  const pptx = await buildPptx([result.data], { w: 1280, h: 720 });
  await pptx.writeFile({ fileName: "output.pptx" });
} else {
  // Validation failed - check error details
  console.error("Validation failed:", result.error.format());
}
```

### Available Input Schemas

| Schema                          | Description                                |
| ------------------------------- | ------------------------------------------ |
| `inputPomNodeSchema`            | Main node schema (includes all node types) |
| `inputTextNodeSchema`           | For text nodes                             |
| `inputImageNodeSchema`          | For image nodes                            |
| `inputTableNodeSchema`          | For table nodes                            |
| `inputShapeNodeSchema`          | For shape nodes                            |
| `inputChartNodeSchema`          | For chart nodes                            |
| `inputTimelineNodeSchema`       | For timeline nodes                         |
| `inputMatrixNodeSchema`         | For matrix nodes                           |
| `inputTreeNodeSchema`           | For tree nodes                             |
| `inputFlowNodeSchema`           | For flow nodes                             |
| `inputProcessArrowNodeSchema`   | For processArrow nodes                     |
| `inputBoxNodeSchema`            | For Box nodes                              |
| `inputVStackNodeSchema`         | For VStack nodes                           |
| `inputHStackNodeSchema`         | For HStack nodes                           |
| `inputMasterSlideOptionsSchema` | For master slide settings                  |

## Input Validation in Browser Environments

If you want to validate LLM output in browser environments (SPAs like React, Vue, Svelte), you can import schemas from `@hirokisakabe/pom/schema`. This subpath exports only schemas without Node.js dependencies, so it works in browsers.

```typescript
// Available in browser environments
import { inputPomNodeSchema } from "@hirokisakabe/pom/schema";

// Validate response from LLM
const result = inputPomNodeSchema.safeParse(llmResponse);

if (result.success) {
  // Validation successful - send to server for PPTX generation
  await fetch("/api/generate-pptx", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(result.data),
  });
} else {
  // Validation failed - show error to user
  console.error("Validation failed:", result.error.format());
}
```

**Difference between `@hirokisakabe/pom` and `@hirokisakabe/pom/schema`:**

| Import Path                | Environment     | Included Features                            |
| -------------------------- | --------------- | -------------------------------------------- |
| `@hirokisakabe/pom`        | Node.js         | Everything (PPTX generation, schemas, types) |
| `@hirokisakabe/pom/schema` | Browser-capable | Schemas and types only (no PPTX generation)  |
